# Two object with the same Map will also have the same prototype object

```shell
V8 version 11.9.0 (candidate)
d8> function Bar(x) {this.x = x;}
undefined

d8> Bar.prototype.getX = function getX() {return this.x;};
function getX() {return this.x;}

d8> const foo = new Bar(true);
undefined

d8> %DebugPrint(foo)
DebugPrint: 0x7700024cdad: [JS_OBJECT_TYPE]
 - map: 0x07700011b28d <Map[48](HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x07700024ccc9 <Object map = 0x7700011b265>
 - elements: 0x077000000219 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x077000000219 <FixedArray[0]>
 - All own properties (excluding elements): {
    0x77000002bdd: [String] in ReadOnlySpace: #x: 0x077000000ddd <true> (const data field 0), location: in-object
}

d8> const qux = new Bar(false);
{x: false}

d8> %DebugPrint(qux)
DebugPrint: 0x7700024d0dd: [JS_OBJECT_TYPE]
 - map: 0x07700011b28d <Map[48](HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x07700024ccc9 <Object map = 0x7700011b265>
 - elements: 0x077000000219 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x077000000219 <FixedArray[0]>
 - All own properties (excluding elements): {
    0x77000002bdd: [String] in ReadOnlySpace: #x: 0x077000000df9 <false> (const data field 0), location: in-object
}
```

# Prototypes are just objects in JavaScript

```shell
d8> %DebugPrintPtr(0x07700024ccc9)    
DebugPrint: 0x7700024ccc9: [JS_OBJECT_TYPE] <-- just an object
 - map: 0x07700011b265 <Map[28](HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x077000104ae1 <Object map = 0x7700010411d>
 - elements: 0x077000000219 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x077000000f71 <PropertyArray[0]>
 - All own properties (excluding elements): {
    0x77000006105: [String] in ReadOnlySpace: #constructor: 0x077000119d95 <JSFunction Bar (sfi = 0x77000119ccd)> (const data field 0), location: in-object
    0x7700011ae95: [String] in OldSpace: #getX: 0x07700011b051 <JSFunction getX (sfi = 0x7700011af01)> (const data field 1), location: in-object
}
```

Its map:

```shell
d8> %DebugPrintPtr(0x7700010411d)
DebugPrint: 0x7700010411d: [Map] in OldSpace
 - type: JS_OBJECT_PROTOTYPE_TYPE
 - instance size: 28
 - inobject properties: 4
 - unused property fields: 2
 - elements kind: HOLEY_ELEMENTS
 - enum length: 0
 - stable_map
 - prototype_map
 - prototype info: 0x077000104ac5 <PrototypeInfo>
 - prototype_validity cell: 0x077000000add <Cell value= 1>
 - instance descriptors (own) #12: 0x077000104961 <DescriptorArray[12]>
 - prototype: 0x077000000235 <null>
 - constructor: 0x077000104625 <JSFunction Object (sfi = 0x77000322f55)>
 - dependent code: 0x077000000229 <Other heap object (WEAK_ARRAY_LIST_TYPE)>
 - construction counter: 0
```

# Change the prototype object of an object

```shell
d8> let obj = {x: 1, y: {a: 1}};
undefined

d8> %DebugPrint(obj)
DebugPrint: 0x2b4f5e277c1: [JS_OBJECT_TYPE] in OldSpace
 - map: 0x2a3e867f4361 <Map[40](HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x0ea3dee970f9 <Object map = 0xf58b5541b61>
 - elements: 0x10e3dedc0259 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x10e3dedc0259 <FixedArray[0]>
 - All own properties (excluding elements): {
    0x10e3dedc38c1: [String] in ReadOnlySpace: #x: 1 (const data field 0), location: in-object
    0x10e3dedc38d9: [String] in ReadOnlySpace: #y: 0x02b4f5e277e9 <Object map = 0x2a3e867f4319> (const data field 1), location: in-object
}

d8> obj.__proto__.x = 1
1

d8> %DebugPrint(obj)
DebugPrint: 0x2b4f5e277c1: [JS_OBJECT_TYPE] in OldSpace
 - map: 0x2a3e867f4361 <Map[40](HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x0ea3dee970f9 <Object map = 0x27eec3dd4be1> <--------- shape of the prototype object has changed
 - elements: 0x10e3dedc0259 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x10e3dedc0259 <FixedArray[0]>
 - All own properties (excluding elements): {
    0x10e3dedc38c1: [String] in ReadOnlySpace: #x: 1 (const data field 0), location: in-object
    0x10e3dedc38d9: [String] in ReadOnlySpace: #y: 0x02b4f5e277e9 <Object map = 0x2a3e867f4319> (const data field 1), location: in-object
}

d8> %DebugPrintPtr(0x27eec3dd4be1)
DebugPrint: 0x27eec3dd4be1: [Map] in OldSpace
 - type: JS_OBJECT_PROTOTYPE_TYPE
 - instance size: 56
 - inobject properties: 4
 - elements kind: HOLEY_ELEMENTS
 - unused property fields: 1
 - enum length: invalid
 - stable_map
 - prototype_map
 - prototype info: 0x0f58b5555161 <PrototypeInfo>
 - prototype_validity cell: 0x27eec3dd50b9 <Cell value= 0>
 - instance descriptors (own) #13: 0x2a3e867ed779 <DescriptorArray[13]>
 - prototype: 0x10e3dedc0269 <null>
 - constructor: 0x0f58b5554b61 <JSFunction Object (sfi = 0x1f0d8618c641)>
 - dependent code: 0x10e3dedc0181 <Other heap object (WEAK_ARRAY_LIST_TYPE)>
 - construction counter: 0
0x10e3dedc0061: [Map] in ReadOnlySpace
 - type: MAP_TYPE
 - instance size: 72
 - elements kind: HOLEY_ELEMENTS
 - unused property fields: 0
 - enum length: invalid
 - stable_map
 - non-extensible
 - back pointer: 0x10e3dedc04e9 <undefined> <---- the new Map is not transitioned from the old Map of the prototype object
 - prototype_validity cell: 0
 - instance descriptors (own) #0: 0x10e3dedc0199 <Other heap object (STRONG_DESCRIPTOR_ARRAY_TYPE)>
 - prototype: 0x10e3dedc0269 <null>
 - constructor: 0x10e3dedc0269 <null>
 - dependent code: 0x10e3dedc0181 <Other heap object (WEAK_ARRAY_LIST_TYPE)>
 - construction counter: 0
```

# Create an object from `Object.create` using an existing object as the prototype

```shell
d8> let obj = {x:13};
undefined

d8> %DebugPrint(obj)
DebugPrint: 0x24370024b009: [JS_OBJECT_TYPE]
 - map: 0x243700119d81 <Map[16](HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x243700104ae1 <Object map = 0x24370010411d>
 - elements: 0x243700000219 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x243700000219 <FixedArray[0]>
 - All own properties (excluding elements): {
    0x243700002bdd: [String] in ReadOnlySpace: #x: 13 (const data field 0), location: in-object
}

d8> Object.create(obj);
{}

d8> %DebugPrint(obj)
DebugPrint: 0x24370024b009: [JS_OBJECT_TYPE]
 - map: 0x24370011b1fd <Map[16](HOLEY_ELEMENTS)> [DictionaryProperties] <---- the Map has changed from FastProperties to DictionaryProperties
 - prototype: 0x243700104ae1 <Object map = 0x24370010411d>
 - elements: 0x243700000219 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x24370024ce85 <NameDictionary[18]> <---- the backing store of properties has changed from FixedArray to NameDictionary
 - All own properties (excluding elements): {
   x: 13 (data, dict_index: 1, attrs: [WEC])
}
```

# Out-of-line property

```shell
Welcome to Node.js v18.18.2.
Type ".help" for more information.
> let a = {x: 1}
undefined

> %DebugPrint(a)
DebugPrint: 0x2b507ed4be1: [JS_OBJECT_TYPE] in OldSpace
 - map: 0x0f5b4179d019 <Map(HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x254b96fed1d9 <Object map = 0x9a62cec1251>
 - elements: 0x12a6205c1329 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x12a6205c1329 <FixedArray[0]>
 - All own properties (excluding elements): {
    0x180ee9f9b541: [String] in OldSpace: #x: 1 (const data field 0), location: in-object
 }
0xf5b4179d019: [Map]
 - type: JS_OBJECT_TYPE
 - instance size: 32
 - inobject properties: 1
 - elements kind: HOLEY_ELEMENTS
 - unused property fields: 0
 - enum length: invalid
 - stable_map
 - back pointer: 0x09a62cec6fb1 <Map(HOLEY_ELEMENTS)>
 - prototype_validity cell: 0x180ee9fb7a71 <Cell value= 1>
 - instance descriptors (own) #1: 0x02b507ed63a9 <DescriptorArray[1]>
 - prototype: 0x254b96fed1d9 <Object map = 0x9a62cec1251>
 - constructor: 0x254b96fcf6e9 <JSFunction Object (sfi = 0x30969397ddf9)>
 - dependent code: 0x12a6205c1251 <Other heap object (WEAK_ARRAY_LIST_TYPE)>
 - construction counter: 0

{ x: 1 }
> a.y = 2
2
> %DebugPrint(a)
DebugPrint: 0x2b507ed4be1: [JS_OBJECT_TYPE] in OldSpace
 - map: 0x0f5b4178ebb9 <Map(HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x254b96fed1d9 <Object map = 0x9a62cec1251>
 - elements: 0x12a6205c1329 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x3a174d349bd9 <PropertyArray[3]>
 - All own properties (excluding elements): {
    0x180ee9f9b541: [String] in OldSpace: #x: 1 (const data field 0), location: in-object
    0x180ee9f9b559: [String] in OldSpace: #y: 2 (const data field 1), location: properties[0]
 }
0xf5b4178ebb9: [Map]
 - type: JS_OBJECT_TYPE
 - instance size: 32
 - inobject properties: 1
 - elements kind: HOLEY_ELEMENTS
 - unused property fields: 2
 - enum length: invalid
 - stable_map
 - back pointer: 0x0f5b4179d019 <Map(HOLEY_ELEMENTS)>
 - prototype_validity cell: 0x254b96fc9631 <Cell value= 0>
 - instance descriptors (own) #2: 0x3a174d349b91 <DescriptorArray[2]>
 - prototype: 0x254b96fed1d9 <Object map = 0x9a62cec1251>
 - constructor: 0x254b96fcf6e9 <JSFunction Object (sfi = 0x30969397ddf9)>
 - dependent code: 0x12a6205c1251 <Other heap object (WEAK_ARRAY_LIST_TYPE)>
 - construction counter: 0
```

# Object with an inline and an out-of-line property before and after the transition

```shell
> function vuln(e){return e.a,%DebugPrint(e),Object.create(e),%DebugPrint(e),e.b}
undefined

> let obj = {a:42}
undefined

> obj.b = 43
43

> vuln(obj)
DebugPrint: 0x3488f1c49a31: [JS_OBJECT_TYPE]
 - map: 0x3c6f09d82841 <Map(HOLEY_ELEMENTS)> [FastProperties]
 - prototype: 0x3faf54b6d1d9 <Object map = 0x3c6f09d81251>
 - elements: 0x3a4489781329 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x3488f1c4a959 <PropertyArray[3]>
 - All own properties (excluding elements): {
    0x3a448978a011: [String] in ReadOnlySpace: #a: 42 (const data field 0), location: in-object
    0x3a448978a0d1: [String] in ReadOnlySpace: #b: 43 (const data field 1), location: properties[0]
 }

DebugPrint: 0x3488f1c49a31: [JS_OBJECT_TYPE]
 - map: 0x3c6f09d828d1 <Map(HOLEY_ELEMENTS)> [DictionaryProperties]
 - prototype: 0x3faf54b6d1d9 <Object map = 0x3c6f09d81251>
 - elements: 0x3a4489781329 <FixedArray[0]> [HOLEY_ELEMENTS]
 - properties: 0x3a95a8f235b9 <NameDictionary[29]>
 - All own properties (excluding elements): {
   a: 42 (data, dict_index: 1, attrs: [WEC])
   b: 43 (data, dict_index: 2, attrs: [WEC])
 }
```


